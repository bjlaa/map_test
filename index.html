<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wigot</title>
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <!-- LEAFLETJS -- MAP -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>

    <script src='https://api.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
  </head>

  <body onload='getLocation()'>
<!-- Mise en page bootstrap via flexbox, deux colonnes. 
la première faisant 9 et la seconde 3 pour arriver à 12 -->
<!--div id="conteneur" class="container">
     <h1>WIGOT - <i>What is going on tonight ?</i></h1-->
     
<!-- Première colonne -->
     
    <!--div class="col-lg-9">
        <h4>Put your Pin Yo' !</h4>
        <img class="img-responsive" src="https://planmetro.paris/wp-content/uploads/2015/10/paris-map.jpg">
        <div id="input" class="row">
            <input type="text" class="form-control" v-model="inputPin" ref="modif" placeholder="Entre un Pin">
            <button type="button" class="btn btn-primary" @click="ajouter()">Ajouter</button>
        </div>
    </div-->

<!-- Deuxième colonne, séparée en deux lignes -->
     
    <!---div class="col-lg-3">
        <div class="row">
            <div class="card">
                <h3 class="card-header">Meilleur Pin</h3>
                <div class="card-body">
                    <p>Le pin #1 est...</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="card">
                <div class="card-header">
                    <h4>Pins ajoutés :</h4>
                </div>
                <div class="card-body">
                    <table>
                        <tbody>
                        <tr v-for="(pin, index) in pins">
                            <td>{{ pin.nom }}</td>
                            <td>{{ pin.score }}</td>
                            <td><button type="button">Like</button>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div-->
<div id='conteneur' class='app'>
  <main class="mapContainer">
    <!--h4>Put your Pin Yo' !</h4-->
    <div class="searchBar">
      <input type="text" class="searchInput form-control" v-model="inputPin" ref="modif" placeholder="Entre un Pin">
      <button type="button" class="searchButton btn btn-primary" @click="ajouter()">Ajouter</button>
    </div>
    <div id="map" class="map"></div>
  </main>
  <aside class="sidebar">
    <div>
      <div class="card">
        <h3 class="card-header">Meilleur Pin</h3>
        <div class="card-body">
          <p>Le pin #1 est...</p>
        </div>
      </div>
    </div>
    <div>
      <div class="card">
        <div class="card-header">
          <h4>Pins ajoutés :</h4>
        </div>
        <div class="card-body">
          <table>
            <tbody>
            <tr v-for="(pin, index) in pins">
              <td>{{ pin.nom }}</td>
              <td>{{ pin.score }}</td>
              <td><button type="button">Like</button>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </aside>
</div>
      
<script src="https://unpkg.com/vue@2.0.3/dist/vue.js"></script>
 
 <script>
  /*
    Initiates the app
    => Put all the code that needs to be run when the app 
    starts here
  */
  function initApp(coords) {

    /*
      LEAFLETJS MAP
    */
    var map;
    // Create the map
    // We use the user's coordinates to center the map on his position
    // if he accepted to give his location

    if (coords) {
      console.log('coord', coords)
      map = window.L.map('map').setView([coords.lat, coords.long], 13);
    } else {
      // Else we initialize the map with random coordinates
      map = window.L.map('map').setView([51.505, -0.09], 13);
    }

    // Add the tilelayer -- the map drawings
    window.L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox.streets',
      accessToken: 'pk.eyJ1IjoiYmpsYWEiLCJhIjoiY2pubzRmYm1iMGI5czNycTFsYTJpZng5biJ9.hbgbuJ24OKVcx4xELavpoQ'
    }).addTo(map);

    /*
      VUEJS
    */
    var app = new window.Vue({
      el: '#conteneur',
      data: {
        pins: [
          { nom: "Le Mazet", score: 0 }
        ],
        inputPin: ''
      },
      methods: {
        ajouter: function () {
          this.pins.push({ nom: this.inputPin, score: 0 });
          this.inputPin = '';
        }
      }
    });
  }

  // We'll use this variable to display a discreet modal inviting
  // the user to try and give his location again
  var isMissingLocation = false;
  /*
    Get current position - called by body.onload
  */
  function getLocation() {

    if ('geolocation' in navigator) {
      navigator.geolocation.getCurrentPosition(
        // success callback: the user has accepted to give his location
        function(position) {
          console.log('SUCCESS in getLocation(): position ===', position);
          initApp({ lat: position.coords.latitude, long: position.coords.longitude });
        },
        // error callback: the user refused to give his location
        function(error) {
          initApp();
          isMissingLocation = true;
        },
      );
    } else {
      console.log('ERROR in initApp(): geolocation is not available on this browser.');
    }
  }
</script> 
      
    </body>

</html>